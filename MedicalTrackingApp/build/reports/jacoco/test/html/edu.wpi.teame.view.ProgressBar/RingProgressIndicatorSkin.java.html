<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>RingProgressIndicatorSkin.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">MedicalTrackingApp</a> &gt; <a href="index.source.html" class="el_package">edu.wpi.teame.view.ProgressBar</a> &gt; <span class="el_source">RingProgressIndicatorSkin.java</span></div><h1>RingProgressIndicatorSkin.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 2014, Andrea Vacondio
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package edu.wpi.teame.view.ProgressBar;

import javafx.animation.Animation;
import javafx.animation.Interpolator;
import javafx.animation.RotateTransition;
import javafx.scene.Node;
import javafx.scene.control.Label;
import javafx.scene.control.Skin;
import javafx.scene.layout.Region;
import javafx.scene.layout.StackPane;
import javafx.scene.shape.Arc;
import javafx.scene.shape.Circle;
import javafx.util.Duration;

/**
 * Skin of the ring progress indicator where an arc grows and by the progress value up to 100% where
 * the arc becomes a ring.
 *
 * @author Andrea Vacondio
 */
public class RingProgressIndicatorSkin implements Skin&lt;RingProgressIndicator&gt; {

  private final RingProgressIndicator indicator;
<span class="nc" id="L39">  private final Label percentLabel = new Label();</span>
<span class="nc" id="L40">  private final Circle innerCircle = new Circle();</span>
<span class="nc" id="L41">  private final Circle outerCircle = new Circle();</span>
<span class="nc" id="L42">  private final StackPane container = new StackPane();</span>
<span class="nc" id="L43">  private final Arc fillerArc = new Arc();</span>
<span class="nc" id="L44">  private final RotateTransition transition =</span>
<span class="nc" id="L45">      new RotateTransition(Duration.millis(2000), fillerArc);</span>

<span class="nc" id="L47">  public RingProgressIndicatorSkin(final RingProgressIndicator indicator) {</span>
<span class="nc" id="L48">    this.indicator = indicator;</span>
<span class="nc" id="L49">    initContainer(indicator);</span>
<span class="nc" id="L50">    initFillerArc();</span>
<span class="nc" id="L51">    container</span>
<span class="nc" id="L52">        .widthProperty()</span>
<span class="nc" id="L53">        .addListener(</span>
            (o, oldVal, newVal) -&gt; {
<span class="nc" id="L55">              fillerArc.setCenterX(newVal.intValue() / 2);</span>
<span class="nc" id="L56">            });</span>
<span class="nc" id="L57">    container</span>
<span class="nc" id="L58">        .heightProperty()</span>
<span class="nc" id="L59">        .addListener(</span>
            (o, oldVal, newVal) -&gt; {
<span class="nc" id="L61">              fillerArc.setCenterY(newVal.intValue() / 2);</span>
<span class="nc" id="L62">            });</span>
<span class="nc" id="L63">    innerCircle.getStyleClass().add(&quot;ringindicator-inner-circle&quot;);</span>
<span class="nc" id="L64">    outerCircle.getStyleClass().add(&quot;ringindicator-outer-circle-secondary&quot;);</span>
<span class="nc" id="L65">    updateRadii();</span>

<span class="nc" id="L67">    this.indicator</span>
<span class="nc" id="L68">        .indeterminateProperty()</span>
<span class="nc" id="L69">        .addListener(</span>
            (o, oldVal, newVal) -&gt; {
<span class="nc" id="L71">              initIndeterminate(newVal);</span>
<span class="nc" id="L72">            });</span>
<span class="nc" id="L73">    this.indicator</span>
<span class="nc" id="L74">        .progressProperty()</span>
<span class="nc" id="L75">        .addListener(</span>
            (o, oldVal, newVal) -&gt; {
<span class="nc bnc" id="L77" title="All 2 branches missed.">              if (newVal.intValue() &gt;= 0) {</span>
<span class="nc" id="L78">                setProgressLabel(newVal.intValue());</span>
<span class="nc" id="L79">                fillerArc.setLength(newVal.intValue() * -3.6);</span>
              }
<span class="nc" id="L81">            });</span>
<span class="nc" id="L82">    this.indicator</span>
<span class="nc" id="L83">        .ringWidthProperty()</span>
<span class="nc" id="L84">        .addListener(</span>
            (o, oldVal, newVal) -&gt; {
<span class="nc" id="L86">              updateRadii();</span>
<span class="nc" id="L87">            });</span>
<span class="nc" id="L88">    innerCircle</span>
<span class="nc" id="L89">        .strokeWidthProperty()</span>
<span class="nc" id="L90">        .addListener(</span>
            (e) -&gt; {
<span class="nc" id="L92">              updateRadii();</span>
<span class="nc" id="L93">            });</span>
<span class="nc" id="L94">    innerCircle</span>
<span class="nc" id="L95">        .radiusProperty()</span>
<span class="nc" id="L96">        .addListener(</span>
            (e) -&gt; {
<span class="nc" id="L98">              updateRadii();</span>
<span class="nc" id="L99">            });</span>
<span class="nc" id="L100">    initTransition();</span>
<span class="nc" id="L101">    initIndeterminate(indicator.isIndeterminate());</span>
<span class="nc" id="L102">    initLabel(indicator.getProgress());</span>
<span class="nc" id="L103">    indicator</span>
<span class="nc" id="L104">        .visibleProperty()</span>
<span class="nc" id="L105">        .addListener(</span>
            (o, oldVal, newVal) -&gt; {
<span class="nc bnc" id="L107" title="All 4 branches missed.">              if (newVal &amp;&amp; this.indicator.isIndeterminate()) {</span>
<span class="nc" id="L108">                transition.play();</span>
              } else {
<span class="nc" id="L110">                transition.pause();</span>
              }
<span class="nc" id="L112">            });</span>
<span class="nc" id="L113">    container.getChildren().addAll(fillerArc, outerCircle, innerCircle, percentLabel);</span>
<span class="nc" id="L114">  }</span>

  private void setProgressLabel(int value) {
<span class="nc bnc" id="L117" title="All 2 branches missed.">    if (value &gt;= 0) {</span>
<span class="nc" id="L118">      percentLabel.setText(String.format(&quot;%d%%&quot;, value));</span>
    }
<span class="nc" id="L120">  }</span>

  private void initTransition() {
<span class="nc" id="L123">    transition.setAutoReverse(false);</span>
<span class="nc" id="L124">    transition.setCycleCount(Animation.INDEFINITE);</span>
<span class="nc" id="L125">    transition.setDelay(Duration.ZERO);</span>
<span class="nc" id="L126">    transition.setInterpolator(Interpolator.LINEAR);</span>
<span class="nc" id="L127">    transition.setByAngle(360);</span>
<span class="nc" id="L128">  }</span>

  private void initFillerArc() {
<span class="nc" id="L131">    fillerArc.setManaged(false);</span>
<span class="nc" id="L132">    fillerArc.getStyleClass().add(&quot;ringindicator-filler&quot;);</span>
<span class="nc" id="L133">    fillerArc.setStartAngle(90);</span>
<span class="nc" id="L134">    fillerArc.setLength(indicator.getProgress() * -3.6);</span>
<span class="nc" id="L135">  }</span>

  private void initContainer(final RingProgressIndicator indicator) {
<span class="nc" id="L138">    container.getStylesheets().addAll(indicator.getStylesheets());</span>
<span class="nc" id="L139">    container.getStyleClass().addAll(&quot;circleindicator-container&quot;);</span>
<span class="nc" id="L140">    container.setMaxHeight(Region.USE_PREF_SIZE);</span>
<span class="nc" id="L141">    container.setMaxWidth(Region.USE_PREF_SIZE);</span>
<span class="nc" id="L142">  }</span>

  private void updateRadii() {
<span class="nc" id="L145">    double ringWidth = indicator.getRingWidth();</span>
<span class="nc" id="L146">    double innerCircleHalfStrokeWidth = innerCircle.getStrokeWidth() / 2;</span>
<span class="nc" id="L147">    double innerCircleRadius = indicator.getInnerCircleRadius();</span>
<span class="nc" id="L148">    outerCircle.setRadius(innerCircleRadius + innerCircleHalfStrokeWidth + ringWidth);</span>
<span class="nc" id="L149">    fillerArc.setRadiusY(innerCircleRadius + innerCircleHalfStrokeWidth - 1 + (ringWidth / 2));</span>
<span class="nc" id="L150">    fillerArc.setRadiusX(innerCircleRadius + innerCircleHalfStrokeWidth - 1 + (ringWidth / 2));</span>
<span class="nc" id="L151">    fillerArc.setStrokeWidth(ringWidth);</span>
<span class="nc" id="L152">    innerCircle.setRadius(innerCircleRadius);</span>
<span class="nc" id="L153">  }</span>

  private void initLabel(int value) {
<span class="nc" id="L156">    setProgressLabel(value);</span>
<span class="nc" id="L157">    percentLabel.getStyleClass().add(&quot;circleindicator-label&quot;);</span>
<span class="nc" id="L158">  }</span>

  private void initIndeterminate(boolean newVal) {
<span class="nc bnc" id="L161" title="All 2 branches missed.">    percentLabel.setVisible(!newVal);</span>
<span class="nc bnc" id="L162" title="All 2 branches missed.">    if (newVal) {</span>
<span class="nc" id="L163">      fillerArc.setLength(360);</span>
<span class="nc" id="L164">      fillerArc.getStyleClass().add(&quot;indeterminate&quot;);</span>
<span class="nc bnc" id="L165" title="All 2 branches missed.">      if (indicator.isVisible()) {</span>
<span class="nc" id="L166">        transition.play();</span>
      }
    } else {
<span class="nc" id="L169">      fillerArc.getStyleClass().remove(&quot;indeterminate&quot;);</span>
<span class="nc" id="L170">      fillerArc.setRotate(0);</span>
<span class="nc" id="L171">      transition.stop();</span>
    }
<span class="nc" id="L173">  }</span>

  @Override
  public RingProgressIndicator getSkinnable() {
<span class="nc" id="L177">    return indicator;</span>
  }

  @Override
  public Node getNode() {
<span class="nc" id="L182">    return container;</span>
  }

  @Override
  public void dispose() {
<span class="nc" id="L187">    transition.stop();</span>
<span class="nc" id="L188">  }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.4.201905082037</span></div></body></html>