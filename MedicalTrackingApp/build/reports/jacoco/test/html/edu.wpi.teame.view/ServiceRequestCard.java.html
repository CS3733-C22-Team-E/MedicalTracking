<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ServiceRequestCard.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">MedicalTrackingApp</a> &gt; <a href="index.source.html" class="el_package">edu.wpi.teame.view</a> &gt; <span class="el_source">ServiceRequestCard.java</span></div><h1>ServiceRequestCard.java</h1><pre class="source lang-java linenums">package edu.wpi.teame.view;

import static edu.wpi.teame.model.enums.DataBaseObjectType.*;

import com.jfoenix.controls.JFXCheckBox;
import edu.wpi.teame.model.Location;
import edu.wpi.teame.model.enums.FloorType;
import edu.wpi.teame.model.enums.ServiceRequestStatus;
import edu.wpi.teame.model.serviceRequests.*;
import java.sql.SQLException;
import javafx.geometry.HPos;
import javafx.geometry.Insets;
import javafx.geometry.Pos;
import javafx.scene.control.Separator;
import javafx.scene.control.Tooltip;
import javafx.scene.effect.DropShadow;
import javafx.scene.layout.*;
import javafx.scene.paint.Color;
import javafx.scene.paint.CycleMethod;
import javafx.scene.paint.LinearGradient;
import javafx.scene.paint.Stop;
import javafx.scene.text.Font;
import javafx.scene.text.FontWeight;
import javafx.scene.text.Text;
import javafx.scene.text.TextAlignment;

public class ServiceRequestCard {

  // Styling
<span class="nc" id="L30">  private final int BORDERRADIUS = 10;</span>

  // Details
  private final ServiceRequestBacklog backlog;
  private String patientName;
  private Location location;
  private final ServiceRequest sr;
  private final Color color;
  private Background nonHoverBG;
  private Background hoverBG;
<span class="nc" id="L40">  private boolean isDead = false;</span>

<span class="nc" id="L42">  public ServiceRequestCard(ServiceRequest serviceRequest, ServiceRequestBacklog b) {</span>
<span class="nc" id="L43">    sr = serviceRequest;</span>
<span class="nc" id="L44">    backlog = b;</span>
<span class="nc" id="L45">    color = getServiceRequestColor();</span>
<span class="nc" id="L46">    location = sr.getLocation();</span>
<span class="nc" id="L47">  }</span>

<span class="nc" id="L49">  public ServiceRequestCard(ServiceRequest serviceRequest, ServiceRequestBacklog b, boolean dead) {</span>
<span class="nc" id="L50">    sr = serviceRequest;</span>
<span class="nc" id="L51">    backlog = b;</span>
<span class="nc" id="L52">    color = getServiceRequestColor();</span>
<span class="nc" id="L53">    location = sr.getLocation();</span>
<span class="nc" id="L54">    isDead = true;</span>
<span class="nc" id="L55">  }</span>

  public HBox getCard(double width, double height) {
    // Setup grid
<span class="nc" id="L59">    HBox card = new HBox();</span>
<span class="nc bnc" id="L60" title="All 2 branches missed.">    if (!isDead) {</span>
<span class="nc" id="L61">      card.setEffect(new DropShadow(5, color));</span>
    }
<span class="nc" id="L63">    Stop[] stops = new Stop[] {new Stop(0, Color.WHITE), new Stop(1, color)};</span>
<span class="nc" id="L64">    Stop[] stops2 = new Stop[] {new Stop(0, Color.LIGHTGRAY), new Stop(1, color)};</span>
<span class="nc" id="L65">    LinearGradient lg1 = new LinearGradient(0, 0, 1, 0, true, CycleMethod.NO_CYCLE, stops);</span>
<span class="nc" id="L66">    LinearGradient lg2 = new LinearGradient(0, 0, 1, 0, true, CycleMethod.NO_CYCLE, stops2);</span>
<span class="nc" id="L67">    nonHoverBG = new Background(new BackgroundFill(lg1, CornerRadii.EMPTY, Insets.EMPTY));</span>
<span class="nc" id="L68">    hoverBG = new Background(new BackgroundFill(lg2, CornerRadii.EMPTY, Insets.EMPTY));</span>
<span class="nc bnc" id="L69" title="All 2 branches missed.">    if (!isDead) {</span>
<span class="nc" id="L70">      card.setBackground(nonHoverBG);</span>
    } else {
<span class="nc" id="L72">      card.setBackground(</span>
          new Background(new BackgroundFill(Color.GRAY, CornerRadii.EMPTY, Insets.EMPTY)));
    }

<span class="nc" id="L76">    createBookend(card, 40);</span>
<span class="nc" id="L77">    card.getChildren().add(getDoneCheckbox());</span>
<span class="nc" id="L78">    createBookend(card, 80);</span>

<span class="nc" id="L80">    GridPane titleAndDescription = new GridPane();</span>
<span class="nc" id="L81">    titleAndDescription.setAlignment(Pos.CENTER);</span>
<span class="nc" id="L82">    titleAndDescription.add(getTitleText(), 0, 0);</span>
<span class="nc" id="L83">    titleAndDescription.add(getSeparatorH(), 0, 1);</span>
<span class="nc" id="L84">    titleAndDescription.add(getDescriptionText(), 0, 2);</span>
<span class="nc" id="L85">    titleAndDescription.setAlignment(Pos.CENTER_LEFT);</span>
<span class="nc" id="L86">    card.getChildren().add(titleAndDescription);</span>
<span class="nc" id="L87">    createSpacer(card);</span>

<span class="nc" id="L89">    GridPane detailsGrid = new GridPane();</span>
<span class="nc" id="L90">    detailsGrid.setAlignment(Pos.CENTER);</span>
<span class="nc" id="L91">    detailsGrid.setHgap(20);</span>
<span class="nc" id="L92">    detailsGrid.add(generateDetailText(&quot;Assignee: &quot;), 2, 0);</span>
<span class="nc" id="L93">    detailsGrid.add(getSeparatorH(), 2, 1);</span>
<span class="nc" id="L94">    detailsGrid.add(generateDetailText(&quot;Location: &quot;), 2, 2);</span>
<span class="nc" id="L95">    detailsGrid.add(getSeparatorH(), 2, 3);</span>
<span class="nc" id="L96">    detailsGrid.add(generateDetailText(&quot;Floor: &quot;), 2, 4);</span>
<span class="nc" id="L97">    detailsGrid.add(getSeparatorH(), 2, 5);</span>
<span class="nc" id="L98">    detailsGrid.add(generateDetailText(&quot;Status: &quot;), 2, 6);</span>
<span class="nc" id="L99">    detailsGrid.add(getSeparatorH(), 2, 7);</span>

<span class="nc" id="L101">    detailsGrid.add(generateDetailText(sr.getAssignee().getName()), 3, 0);</span>
<span class="nc" id="L102">    detailsGrid.add(getSeparatorH(), 3, 1);</span>
<span class="nc" id="L103">    detailsGrid.add(generateDetailText(location.getLongName()), 3, 2);</span>
<span class="nc" id="L104">    detailsGrid.add(getSeparatorH(), 3, 3);</span>
<span class="nc" id="L105">    detailsGrid.add(generateDetailText(location.getFloor().name()), 3, 4);</span>
<span class="nc" id="L106">    detailsGrid.add(getSeparatorH(), 3, 5);</span>
<span class="nc" id="L107">    detailsGrid.add(generateDetailText(sr.getStatus().name()), 3, 6);</span>
<span class="nc" id="L108">    detailsGrid.add(getSeparatorH(), 3, 7);</span>
<span class="nc" id="L109">    card.getChildren().add(detailsGrid);</span>
<span class="nc" id="L110">    createBookend(card, 40);</span>

<span class="nc" id="L112">    card.setAlignment(Pos.CENTER_RIGHT);</span>
<span class="nc" id="L113">    card.setPrefSize(width, height);</span>
<span class="nc" id="L114">    card.setFillHeight(false);</span>
<span class="nc bnc" id="L115" title="All 2 branches missed.">    if (!isDead) {</span>
<span class="nc" id="L116">      setHoverStyling(card);</span>
    }
<span class="nc" id="L118">    return card;</span>
  }

  private Text generateDetailText(String text) {
<span class="nc" id="L122">    Text detailText = new Text(text);</span>
<span class="nc" id="L123">    detailText.setFont(Font.font(&quot;Arial&quot;, FontWeight.BOLD, 16));</span>
<span class="nc" id="L124">    detailText.setFill(Color.BLACK);</span>
<span class="nc" id="L125">    detailText.setTextAlignment(TextAlignment.RIGHT);</span>
<span class="nc" id="L126">    return detailText;</span>
  }

  private HBox getTitleText() {
<span class="nc" id="L130">    HBox textBox = new HBox();</span>
<span class="nc" id="L131">    Text titleText = new Text(sr.getDBType().shortName());</span>
<span class="nc" id="L132">    titleText.setFont(Font.font(&quot;Arial&quot;, FontWeight.BOLD, 24));</span>
<span class="nc" id="L133">    textBox.getChildren().add(titleText);</span>
<span class="nc" id="L134">    Text srText = new Text(&quot; Service Request&quot;);</span>
<span class="nc" id="L135">    srText.setFont(Font.font(&quot;Arial&quot;, FontWeight.BOLD, 16));</span>
<span class="nc bnc" id="L136" title="All 2 branches missed.">    if (!isDead) {</span>
<span class="nc" id="L137">      srText.setFill(color);</span>
    }
<span class="nc" id="L139">    textBox.getChildren().add(srText);</span>
<span class="nc" id="L140">    textBox.setAlignment(Pos.CENTER_LEFT);</span>
<span class="nc" id="L141">    return textBox;</span>
  }

  private JFXCheckBox getDoneCheckbox() {
<span class="nc" id="L145">    JFXCheckBox doneBox = new JFXCheckBox();</span>
<span class="nc" id="L146">    doneBox.setCheckedColor(Color.LIGHTBLUE);</span>
<span class="nc" id="L147">    doneBox.setCheckedColor(Color.LIGHTGRAY);</span>
<span class="nc" id="L148">    doneBox.setPadding(new Insets(0, -40, 0, 0));</span>
<span class="nc" id="L149">    doneBox.setScaleX(2);</span>
<span class="nc" id="L150">    doneBox.setScaleY(2);</span>
<span class="nc" id="L151">    doneBox.setOnMouseClicked(</span>
        (event -&gt; {
          try {
<span class="nc" id="L154">            deleteRequest(backlog);</span>
<span class="nc" id="L155">          } catch (SQLException e) {</span>
<span class="nc" id="L156">            e.printStackTrace();</span>
<span class="nc" id="L157">          }</span>
<span class="nc" id="L158">        }));</span>
<span class="nc" id="L159">    Tooltip t = new Tooltip(&quot;Click to delete&quot;);</span>
<span class="nc" id="L160">    Tooltip.install(doneBox, t);</span>
<span class="nc" id="L161">    return doneBox;</span>
  }

  private Text getDescriptionText() {
<span class="nc" id="L165">    String d = &quot;&quot;;</span>
<span class="nc bnc" id="L166" title="All 2 branches missed.">    if (sr.getDBType() == FoodDeliverySR) {</span>
<span class="nc" id="L167">      FoodDeliveryServiceRequest s = (FoodDeliveryServiceRequest) sr;</span>
<span class="nc" id="L168">      d =</span>
          &quot;Deliver &quot;
<span class="nc" id="L170">              + s.getFood()</span>
              + &quot; to patient \&quot;&quot;
<span class="nc" id="L172">              + s.getPatient().getName()</span>
              + &quot;\&quot; at the requested location.&quot;;
<span class="nc bnc" id="L174" title="All 2 branches missed.">    } else if (sr.getDBType() == GiftAndFloralSR) {</span>
<span class="nc" id="L175">      GiftAndFloralServiceRequest s = (GiftAndFloralServiceRequest) sr;</span>
<span class="nc" id="L176">      d =</span>
          &quot;Fulfil a Gift/Floral Service Request to patient \&quot;&quot;
<span class="nc" id="L178">              + s.getPatient().getName()</span>
              + &quot;\&quot; at the requested location.&quot;;
<span class="nc bnc" id="L180" title="All 2 branches missed.">    } else if (sr.getDBType() == LanguageInterpreterSR) {</span>
<span class="nc" id="L181">      LanguageInterpreterServiceRequest s = (LanguageInterpreterServiceRequest) sr;</span>
<span class="nc" id="L182">      d =</span>
          &quot;Get a Language Interpreter that speaks &quot;
<span class="nc" id="L184">              + s.getLanguage().name()</span>
              + &quot; to patient \&quot;&quot;
<span class="nc" id="L186">              + s.getPatient().getName()</span>
              + &quot;\&quot; at the requested location.&quot;;
<span class="nc bnc" id="L188" title="All 2 branches missed.">    } else if (sr.getDBType() == MedicalEquipmentSR) {</span>
<span class="nc" id="L189">      MedicalEquipmentServiceRequest s = (MedicalEquipmentServiceRequest) sr;</span>
<span class="nc" id="L190">      d = &quot;Deliver equipment \&quot;&quot; + s.getEquipment().getName() + &quot;\&quot; to the requested location.&quot;;</span>
<span class="nc bnc" id="L191" title="All 2 branches missed.">    } else if (sr.getDBType() == MedicineDeliverySR) {</span>
<span class="nc" id="L192">      MedicineDeliveryServiceRequest s = (MedicineDeliveryServiceRequest) sr;</span>
<span class="nc" id="L193">      d =</span>
          &quot;Deliver medicine \&quot;&quot;
<span class="nc" id="L195">              + s.getMedicineName()</span>
              + &quot;\&quot; in quantity \&quot;&quot;
<span class="nc" id="L197">              + s.getMedicineQuantity()</span>
              + &quot;\&quot; to patient \&quot;&quot;
<span class="nc" id="L199">              + s.getPatient().getName()</span>
              + &quot;\&quot; at the requested location.&quot;;
<span class="nc bnc" id="L201" title="All 2 branches missed.">    } else if (sr.getDBType() == InternalPatientTransferSR) {</span>
<span class="nc" id="L202">      PatientTransportationServiceRequest s = (PatientTransportationServiceRequest) sr;</span>
<span class="nc" id="L203">      d =</span>
          &quot;Transport patient \&quot;&quot;
<span class="nc" id="L205">              + s.getPatient().getName()</span>
              + &quot;\&quot; internally from location \&quot;&quot;
<span class="nc" id="L207">              + s.getLocation().getShortName()</span>
              + &quot;\&quot; to location \&quot;&quot;
<span class="nc" id="L209">              + s.getDestination().getShortName()</span>
              + &quot;\&quot;.&quot;;
<span class="nc bnc" id="L211" title="All 2 branches missed.">      if (s.getEquipment() != null) {</span>
<span class="nc" id="L212">        d += &quot;\nBring equipment: &quot; + s.getEquipment().getName();</span>
      }
<span class="nc bnc" id="L214" title="All 2 branches missed.">    } else if (sr.getDBType() == ExternalPatientSR) {</span>
<span class="nc" id="L215">      PatientTransportationServiceRequest s = (PatientTransportationServiceRequest) sr;</span>
<span class="nc" id="L216">      d =</span>
          &quot;Transport patient \&quot;&quot;
<span class="nc" id="L218">              + s.getPatient().getName()</span>
              + &quot;\&quot; externally from location \&quot;&quot;
<span class="nc" id="L220">              + s.getLocation().getShortName()</span>
              + &quot;\&quot; to location \&quot;&quot;
<span class="nc" id="L222">              + s.getDestination().getShortName()</span>
              + &quot;\&quot;.&quot;;
<span class="nc bnc" id="L224" title="All 2 branches missed.">      if (s.getEquipment() != null) {</span>
<span class="nc" id="L225">        d += &quot;\nBring equipment: &quot; + s.getEquipment().getName();</span>
      }
<span class="nc bnc" id="L227" title="All 2 branches missed.">    } else if (sr.getDBType() == ReligiousSR) {</span>
<span class="nc" id="L228">      ReligiousServiceRequest s = (ReligiousServiceRequest) sr;</span>
<span class="nc" id="L229">      d =</span>
          &quot;Get a religious official of religion \&quot;&quot;
<span class="nc" id="L231">              + s.getReligion()</span>
              + &quot;\&quot; to patient \&quot;&quot;
<span class="nc" id="L233">              + s.getPatient().getName()</span>
              + &quot;\&quot; at the requested location.&quot;;
    }

<span class="nc bnc" id="L237" title="All 2 branches missed.">    if (!sr.getAdditionalInfo().equals(&quot;&quot;)) {</span>
<span class="nc" id="L238">      d = sr.getAdditionalInfo();</span>
    }
<span class="nc bnc" id="L240" title="All 2 branches missed.">    if (d.equals(&quot;&quot;)) {</span>
<span class="nc" id="L241">      d = sr.getDBType().getDescription();</span>
    }

<span class="nc" id="L244">    Text descriptionText = new Text(d);</span>
<span class="nc" id="L245">    descriptionText.setFont(Font.font(&quot;Arial&quot;, 16));</span>
<span class="nc" id="L246">    descriptionText.setFill(Color.BLACK);</span>
<span class="nc" id="L247">    descriptionText.setTextAlignment(TextAlignment.CENTER);</span>
<span class="nc" id="L248">    return descriptionText;</span>
  }

  private Separator getSeparatorH() {
<span class="nc" id="L252">    Separator titleSeparator = new Separator();</span>
<span class="nc" id="L253">    titleSeparator.setScaleX(1);</span>
<span class="nc" id="L254">    titleSeparator.setScaleY(1);</span>
<span class="nc" id="L255">    titleSeparator.setHalignment(HPos.CENTER);</span>
<span class="nc" id="L256">    return titleSeparator;</span>
  }

  private void deleteRequest(ServiceRequestBacklog b) throws SQLException {
<span class="nc bnc" id="L260" title="All 2 branches missed.">    if (!isDead) {</span>
<span class="nc" id="L261">      b.killServiceRequest(this.sr);</span>
    } else {
<span class="nc" id="L263">      b.removeServiceRequest(this.sr);</span>
    }
<span class="nc" id="L265">  }</span>

  public void setPatientName(String patientName) {
<span class="nc" id="L268">    this.patientName = patientName;</span>
<span class="nc" id="L269">  } // TODO change this to SR patient field</span>

  public void setLocation(Location location) {
<span class="nc" id="L272">    this.location = location;</span>
<span class="nc" id="L273">  }</span>

  public void setFloor(FloorType floor) {
<span class="nc" id="L276">    this.location.setFloor(floor);</span>
<span class="nc" id="L277">  }</span>

  public void setStatus(ServiceRequestStatus status) {
<span class="nc" id="L280">    this.sr.setStatus(status);</span>
<span class="nc" id="L281">  }</span>

  private void setHoverStyling(HBox c) {
<span class="nc" id="L284">    c.setOnMouseEntered(e -&gt; c.setBackground(hoverBG));</span>

<span class="nc" id="L286">    c.setOnMouseExited(e -&gt; c.setBackground(nonHoverBG));</span>
<span class="nc" id="L287">  }</span>

  public ServiceRequest getServiceRequest() {
<span class="nc" id="L290">    return this.sr;</span>
  }

  private void createSpacer(HBox c) {
<span class="nc" id="L294">    final Region spacer = new Region();</span>
    // Make it always grow or shrink according to the available space
<span class="nc" id="L296">    HBox.setHgrow(spacer, Priority.ALWAYS);</span>
<span class="nc" id="L297">    c.getChildren().add(spacer);</span>
<span class="nc" id="L298">  }</span>

  private void createBookend(HBox c, double w) {
<span class="nc" id="L301">    final Region spacer = new Region();</span>
    // Make it always grow or shrink according to the available space
<span class="nc" id="L303">    spacer.setPrefWidth(w);</span>
<span class="nc" id="L304">    spacer.setMaxWidth(w);</span>
<span class="nc" id="L305">    spacer.setMinWidth(w);</span>
<span class="nc" id="L306">    HBox.setHgrow(spacer, Priority.SOMETIMES);</span>
<span class="nc" id="L307">    c.getChildren().add(spacer);</span>
<span class="nc" id="L308">  }</span>

  private Color getServiceRequestColor() {
<span class="nc" id="L311">    return this.sr.getDBType().getColor();</span>
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.4.201905082037</span></div></body></html>