<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ServiceRequestCard.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">MedicalTrackingApp</a> &gt; <a href="index.source.html" class="el_package">edu.wpi.teame.view.backlog</a> &gt; <span class="el_source">ServiceRequestCard.java</span></div><h1>ServiceRequestCard.java</h1><pre class="source lang-java linenums">package edu.wpi.teame.view.backlog;

import static edu.wpi.teame.model.enums.DataBaseObjectType.*;

import com.jfoenix.controls.JFXCheckBox;
import edu.wpi.teame.model.Location;
import edu.wpi.teame.model.enums.FloorType;
import edu.wpi.teame.model.enums.ServiceRequestPriority;
import edu.wpi.teame.model.enums.ServiceRequestStatus;
import edu.wpi.teame.model.serviceRequests.*;
import java.sql.SQLException;
import javafx.geometry.HPos;
import javafx.geometry.Insets;
import javafx.geometry.Pos;
import javafx.scene.control.Separator;
import javafx.scene.control.Tooltip;
import javafx.scene.effect.DropShadow;
import javafx.scene.layout.*;
import javafx.scene.paint.Color;
import javafx.scene.paint.CycleMethod;
import javafx.scene.paint.LinearGradient;
import javafx.scene.paint.Stop;
import javafx.scene.text.Font;
import javafx.scene.text.FontWeight;
import javafx.scene.text.Text;
import javafx.scene.text.TextAlignment;

public class ServiceRequestCard {

  // Styling
<span class="nc" id="L31">  private final int BORDERRADIUS = 10;</span>

  // Details
  private final ServiceRequestBacklog backlog;
  private String patientName;
  private Location location;
  private final ServiceRequest sr;
  private final Color color;
  private Background nonHoverBG;
  private Background hoverBG;
<span class="nc" id="L41">  private boolean isDead = false;</span>

<span class="nc" id="L43">  public ServiceRequestCard(ServiceRequest serviceRequest, ServiceRequestBacklog b) {</span>
<span class="nc" id="L44">    sr = serviceRequest;</span>
<span class="nc" id="L45">    backlog = b;</span>
<span class="nc" id="L46">    color = getServiceRequestColor();</span>
<span class="nc" id="L47">    location = sr.getLocation();</span>
<span class="nc" id="L48">  }</span>

<span class="nc" id="L50">  public ServiceRequestCard(ServiceRequest serviceRequest, ServiceRequestBacklog b, boolean dead) {</span>
<span class="nc" id="L51">    sr = serviceRequest;</span>
<span class="nc" id="L52">    backlog = b;</span>
<span class="nc" id="L53">    color = getServiceRequestColor();</span>
<span class="nc" id="L54">    location = sr.getLocation();</span>
<span class="nc" id="L55">    isDead = true;</span>
<span class="nc" id="L56">  }</span>

  public HBox getCard(double width, double height) {
    // Setup grid
<span class="nc" id="L60">    HBox card = new HBox();</span>
<span class="nc bnc" id="L61" title="All 2 branches missed.">    if (!isDead) {</span>
<span class="nc" id="L62">      card.setEffect(new DropShadow(5, color));</span>
    }
<span class="nc" id="L64">    Stop[] stops = new Stop[] {new Stop(0, Color.WHITE), new Stop(1, color)};</span>
<span class="nc" id="L65">    Stop[] stops2 = new Stop[] {new Stop(0, Color.LIGHTGRAY), new Stop(1, color)};</span>
<span class="nc" id="L66">    LinearGradient lg1 = new LinearGradient(0, 0, 1, 0, true, CycleMethod.NO_CYCLE, stops);</span>
<span class="nc" id="L67">    LinearGradient lg2 = new LinearGradient(0, 0, 1, 0, true, CycleMethod.NO_CYCLE, stops2);</span>
<span class="nc" id="L68">    nonHoverBG = new Background(new BackgroundFill(lg1, CornerRadii.EMPTY, Insets.EMPTY));</span>
<span class="nc" id="L69">    hoverBG = new Background(new BackgroundFill(lg2, CornerRadii.EMPTY, Insets.EMPTY));</span>
<span class="nc bnc" id="L70" title="All 2 branches missed.">    if (!isDead) {</span>
<span class="nc" id="L71">      card.setBackground(nonHoverBG);</span>
    } else {
<span class="nc" id="L73">      card.setBackground(</span>
          new Background(new BackgroundFill(Color.GRAY, CornerRadii.EMPTY, Insets.EMPTY)));
    }

<span class="nc" id="L77">    createBookend(card, 40);</span>
<span class="nc" id="L78">    card.getChildren().add(getDoneCheckbox());</span>
<span class="nc" id="L79">    createBookend(card, 80);</span>

<span class="nc" id="L81">    GridPane titleAndDescription = new GridPane();</span>
<span class="nc" id="L82">    titleAndDescription.setAlignment(Pos.CENTER);</span>
<span class="nc" id="L83">    titleAndDescription.add(getTitleText(), 0, 0);</span>
<span class="nc" id="L84">    titleAndDescription.add(getSeparatorH(), 0, 1);</span>
<span class="nc" id="L85">    titleAndDescription.add(getDescriptionText(), 0, 2);</span>
<span class="nc" id="L86">    titleAndDescription.setAlignment(Pos.CENTER_LEFT);</span>
<span class="nc" id="L87">    card.getChildren().add(titleAndDescription);</span>
<span class="nc" id="L88">    createSpacer(card);</span>

<span class="nc" id="L90">    GridPane detailsGrid = new GridPane();</span>
<span class="nc" id="L91">    detailsGrid.setAlignment(Pos.CENTER);</span>
<span class="nc" id="L92">    detailsGrid.setHgap(20);</span>
<span class="nc" id="L93">    detailsGrid.add(generateDetailText(&quot;Assignee: &quot;), 2, 0);</span>
<span class="nc" id="L94">    detailsGrid.add(getSeparatorH(), 2, 1);</span>
<span class="nc" id="L95">    detailsGrid.add(generateDetailText(&quot;Location: &quot;), 2, 2);</span>
<span class="nc" id="L96">    detailsGrid.add(getSeparatorH(), 2, 3);</span>
<span class="nc" id="L97">    detailsGrid.add(generateDetailText(&quot;Priority: &quot;), 2, 4);</span>
<span class="nc" id="L98">    detailsGrid.add(getSeparatorH(), 2, 5);</span>
<span class="nc" id="L99">    detailsGrid.add(generateDetailText(&quot;Status: &quot;), 2, 6);</span>
<span class="nc" id="L100">    detailsGrid.add(getSeparatorH(), 2, 7);</span>

<span class="nc" id="L102">    detailsGrid.add(generateDetailText(sr.getAssignee().getName()), 3, 0);</span>
<span class="nc" id="L103">    detailsGrid.add(getSeparatorH(), 3, 1);</span>
<span class="nc" id="L104">    detailsGrid.add(generateDetailText(location.getLongName()), 3, 2);</span>
<span class="nc" id="L105">    detailsGrid.add(getSeparatorH(), 3, 3);</span>
<span class="nc" id="L106">    detailsGrid.add(generatePriorityText(sr.getPriority().name()), 3, 4);</span>
<span class="nc" id="L107">    detailsGrid.add(getSeparatorH(), 3, 5);</span>
<span class="nc" id="L108">    detailsGrid.add(generateDetailText(sr.getStatus().name()), 3, 6);</span>
<span class="nc" id="L109">    detailsGrid.add(getSeparatorH(), 3, 7);</span>
<span class="nc" id="L110">    card.getChildren().add(detailsGrid);</span>
<span class="nc" id="L111">    createBookend(card, 40);</span>

<span class="nc" id="L113">    card.setAlignment(Pos.CENTER_RIGHT);</span>
<span class="nc" id="L114">    card.setPrefSize(width, height);</span>
<span class="nc" id="L115">    card.setFillHeight(false);</span>
<span class="nc bnc" id="L116" title="All 2 branches missed.">    if (!isDead) {</span>
<span class="nc" id="L117">      setHoverStyling(card);</span>
    }
<span class="nc" id="L119">    return card;</span>
  }

  private HBox generatePriorityText(String text) {
<span class="nc" id="L123">    HBox pBox = new HBox();</span>
<span class="nc" id="L124">    Text priorityText = new Text(text);</span>
<span class="nc" id="L125">    priorityText.setFont(Font.font(&quot;Arial&quot;, FontWeight.BOLD, 16));</span>
<span class="nc bnc" id="L126" title="All 2 branches missed.">    if (sr.getPriority() == ServiceRequestPriority.Low</span>
<span class="nc bnc" id="L127" title="All 2 branches missed.">        || sr.getPriority() == ServiceRequestPriority.Normal) {</span>
<span class="nc" id="L128">      priorityText.setFill(Color.BLACK);</span>
    } else {
<span class="nc" id="L130">      priorityText.setFill(Color.WHITE);</span>
    }
<span class="nc" id="L132">    priorityText.setTextAlignment(TextAlignment.RIGHT);</span>
<span class="nc" id="L133">    pBox.getChildren().add(priorityText);</span>
<span class="nc" id="L134">    pBox.setBackground(</span>
        new Background(
<span class="nc" id="L136">            new BackgroundFill(sr.getPriority().getColor(), new CornerRadii(10), Insets.EMPTY)));</span>
<span class="nc" id="L137">    pBox.setAlignment(Pos.CENTER);</span>
<span class="nc" id="L138">    pBox.setMaxWidth(70);</span>
<span class="nc" id="L139">    return pBox;</span>
  }

  private Text generateDetailText(String text) {
<span class="nc" id="L143">    Text detailText = new Text(text);</span>
<span class="nc" id="L144">    detailText.setFont(Font.font(&quot;Arial&quot;, FontWeight.BOLD, 16));</span>
<span class="nc" id="L145">    detailText.setFill(Color.BLACK);</span>
<span class="nc" id="L146">    detailText.setTextAlignment(TextAlignment.RIGHT);</span>
<span class="nc" id="L147">    return detailText;</span>
  }

  private HBox getTitleText() {
<span class="nc" id="L151">    HBox textBox = new HBox();</span>
<span class="nc" id="L152">    Text titleText = new Text(sr.getDBType().shortName());</span>
<span class="nc" id="L153">    titleText.setFont(Font.font(&quot;Arial&quot;, FontWeight.BOLD, 24));</span>
<span class="nc" id="L154">    textBox.getChildren().add(titleText);</span>
<span class="nc" id="L155">    Text srText = new Text(&quot; Service Request&quot;);</span>
<span class="nc" id="L156">    srText.setFont(Font.font(&quot;Arial&quot;, FontWeight.BOLD, 16));</span>
<span class="nc bnc" id="L157" title="All 2 branches missed.">    if (!isDead) {</span>
<span class="nc" id="L158">      srText.setFill(color);</span>
    }
<span class="nc" id="L160">    textBox.getChildren().add(srText);</span>
<span class="nc" id="L161">    textBox.setAlignment(Pos.CENTER_LEFT);</span>
<span class="nc" id="L162">    return textBox;</span>
  }

  private JFXCheckBox getDoneCheckbox() {
<span class="nc" id="L166">    JFXCheckBox doneBox = new JFXCheckBox();</span>
<span class="nc" id="L167">    doneBox.setCheckedColor(Color.LIGHTBLUE);</span>
<span class="nc" id="L168">    doneBox.setCheckedColor(Color.LIGHTGRAY);</span>
<span class="nc" id="L169">    doneBox.setPadding(new Insets(0, -40, 0, 0));</span>
<span class="nc" id="L170">    doneBox.setScaleX(2);</span>
<span class="nc" id="L171">    doneBox.setScaleY(2);</span>
<span class="nc" id="L172">    doneBox.setOnMouseClicked(</span>
        (event -&gt; {
          try {
<span class="nc" id="L175">            deleteRequest(backlog);</span>
<span class="nc" id="L176">          } catch (SQLException e) {</span>
<span class="nc" id="L177">            e.printStackTrace();</span>
<span class="nc" id="L178">          }</span>
<span class="nc" id="L179">        }));</span>
<span class="nc" id="L180">    Tooltip t = new Tooltip(&quot;Click to mark as done.&quot;);</span>
<span class="nc" id="L181">    Tooltip.install(doneBox, t);</span>
    ;
<span class="nc bnc" id="L183" title="All 2 branches missed.">    if (isDead) {</span>
<span class="nc" id="L184">      t.setText(&quot;Click to delete.&quot;);</span>
<span class="nc" id="L185">      doneBox.setSelected(true);</span>
    }
<span class="nc" id="L187">    Tooltip.install(doneBox, t);</span>
    ;
<span class="nc" id="L189">    return doneBox;</span>
  }

  private Text getDescriptionText() {
<span class="nc" id="L193">    String d = &quot;&quot;;</span>
<span class="nc bnc" id="L194" title="All 2 branches missed.">    if (sr.getDBType() == FoodDeliverySR) {</span>
<span class="nc" id="L195">      FoodDeliveryServiceRequest s = (FoodDeliveryServiceRequest) sr;</span>
<span class="nc" id="L196">      d =</span>
          &quot;Deliver &quot;
<span class="nc" id="L198">              + s.getFood()</span>
              + &quot; to patient \&quot;&quot;
<span class="nc" id="L200">              + s.getPatient().getName()</span>
              + &quot;\&quot; at the requested location.&quot;;
<span class="nc bnc" id="L202" title="All 2 branches missed.">    } else if (sr.getDBType() == GiftAndFloralSR) {</span>
<span class="nc" id="L203">      GiftAndFloralServiceRequest s = (GiftAndFloralServiceRequest) sr;</span>
<span class="nc" id="L204">      d =</span>
          &quot;Fulfil a Gift/Floral Service Request to patient \&quot;&quot;
<span class="nc" id="L206">              + s.getPatient().getName()</span>
              + &quot;\&quot; at the requested location.&quot;;
<span class="nc bnc" id="L208" title="All 2 branches missed.">    } else if (sr.getDBType() == LanguageInterpreterSR) {</span>
<span class="nc" id="L209">      LanguageInterpreterServiceRequest s = (LanguageInterpreterServiceRequest) sr;</span>
<span class="nc" id="L210">      d =</span>
          &quot;Get a Language Interpreter that speaks &quot;
<span class="nc" id="L212">              + s.getLanguage().name()</span>
              + &quot; to patient \&quot;&quot;
<span class="nc" id="L214">              + s.getPatient().getName()</span>
              + &quot;\&quot; at the requested location.&quot;;
<span class="nc bnc" id="L216" title="All 2 branches missed.">    } else if (sr.getDBType() == MedicalEquipmentSR) {</span>
<span class="nc" id="L217">      MedicalEquipmentServiceRequest s = (MedicalEquipmentServiceRequest) sr;</span>
<span class="nc" id="L218">      d = &quot;Deliver equipment \&quot;&quot; + s.getEquipment().getName() + &quot;\&quot; to the requested location.&quot;;</span>
<span class="nc bnc" id="L219" title="All 2 branches missed.">    } else if (sr.getDBType() == MedicineDeliverySR) {</span>
<span class="nc" id="L220">      MedicineDeliveryServiceRequest s = (MedicineDeliveryServiceRequest) sr;</span>
<span class="nc" id="L221">      d =</span>
          &quot;Deliver medicine \&quot;&quot;
<span class="nc" id="L223">              + s.getMedicineName()</span>
              + &quot;\&quot; in quantity \&quot;&quot;
<span class="nc" id="L225">              + s.getMedicineQuantity()</span>
              + &quot;\&quot; to patient \&quot;&quot;
<span class="nc" id="L227">              + s.getPatient().getName()</span>
              + &quot;\&quot; at the requested location.&quot;;
<span class="nc bnc" id="L229" title="All 2 branches missed.">    } else if (sr.getDBType() == InternalPatientTransferSR) {</span>
<span class="nc" id="L230">      PatientTransportationServiceRequest s = (PatientTransportationServiceRequest) sr;</span>
<span class="nc" id="L231">      d =</span>
          &quot;Transport patient \&quot;&quot;
<span class="nc" id="L233">              + s.getPatient().getName()</span>
              + &quot;\&quot; internally from location \&quot;&quot;
<span class="nc" id="L235">              + s.getLocation().getShortName()</span>
              + &quot;\&quot; to location \&quot;&quot;
<span class="nc" id="L237">              + s.getDestination().getShortName()</span>
              + &quot;\&quot;.&quot;;
<span class="nc bnc" id="L239" title="All 2 branches missed.">      if (s.getEquipment() != null) {</span>
<span class="nc" id="L240">        d += &quot;\nBring equipment: &quot; + s.getEquipment().getName();</span>
      }
<span class="nc bnc" id="L242" title="All 2 branches missed.">    } else if (sr.getDBType() == ExternalPatientSR) {</span>
<span class="nc" id="L243">      PatientTransportationServiceRequest s = (PatientTransportationServiceRequest) sr;</span>
<span class="nc" id="L244">      d =</span>
          &quot;Transport patient \&quot;&quot;
<span class="nc" id="L246">              + s.getPatient().getName()</span>
              + &quot;\&quot; externally from location \&quot;&quot;
<span class="nc" id="L248">              + s.getLocation().getShortName()</span>
              + &quot;\&quot; to location \&quot;&quot;
<span class="nc" id="L250">              + s.getDestination().getShortName()</span>
              + &quot;\&quot;.&quot;;
<span class="nc bnc" id="L252" title="All 2 branches missed.">      if (s.getEquipment() != null) {</span>
<span class="nc" id="L253">        d += &quot;\nBring equipment: &quot; + s.getEquipment().getName();</span>
      }
<span class="nc bnc" id="L255" title="All 2 branches missed.">    } else if (sr.getDBType() == ReligiousSR) {</span>
<span class="nc" id="L256">      ReligiousServiceRequest s = (ReligiousServiceRequest) sr;</span>
<span class="nc" id="L257">      d =</span>
          &quot;Get a religious official of religion \&quot;&quot;
<span class="nc" id="L259">              + s.getReligion()</span>
              + &quot;\&quot; to patient \&quot;&quot;
<span class="nc" id="L261">              + s.getPatient().getName()</span>
              + &quot;\&quot; at the requested location.&quot;;
    }

<span class="nc bnc" id="L265" title="All 2 branches missed.">    if (!sr.getAdditionalInfo().equals(&quot;&quot;)) {</span>
<span class="nc" id="L266">      d = sr.getAdditionalInfo();</span>
    }
<span class="nc bnc" id="L268" title="All 2 branches missed.">    if (d.equals(&quot;&quot;)) {</span>
<span class="nc" id="L269">      d = sr.getDBType().getDescription();</span>
    }

<span class="nc" id="L272">    Text descriptionText = new Text(d);</span>
<span class="nc" id="L273">    descriptionText.setFont(Font.font(&quot;Arial&quot;, 16));</span>
<span class="nc" id="L274">    descriptionText.setFill(Color.BLACK);</span>
<span class="nc" id="L275">    descriptionText.setTextAlignment(TextAlignment.CENTER);</span>
<span class="nc" id="L276">    return descriptionText;</span>
  }

  private Separator getSeparatorH() {
<span class="nc" id="L280">    Separator titleSeparator = new Separator();</span>
<span class="nc" id="L281">    titleSeparator.setScaleX(1);</span>
<span class="nc" id="L282">    titleSeparator.setScaleY(1);</span>
<span class="nc" id="L283">    titleSeparator.setHalignment(HPos.CENTER);</span>
<span class="nc" id="L284">    return titleSeparator;</span>
  }

  private void deleteRequest(ServiceRequestBacklog b) throws SQLException {
<span class="nc bnc" id="L288" title="All 2 branches missed.">    if (!isDead) {</span>
<span class="nc" id="L289">      b.killServiceRequest(this.sr);</span>
    } else {
<span class="nc" id="L291">      b.removeServiceRequest(this.sr);</span>
    }
<span class="nc" id="L293">  }</span>

  public void setPatientName(String patientName) {
<span class="nc" id="L296">    this.patientName = patientName;</span>
<span class="nc" id="L297">  } // TODO change this to SR patient field</span>

  public void setLocation(Location location) {
<span class="nc" id="L300">    this.location = location;</span>
<span class="nc" id="L301">  }</span>

  public void setFloor(FloorType floor) {
<span class="nc" id="L304">    this.location.setFloor(floor);</span>
<span class="nc" id="L305">  }</span>

  public void setStatus(ServiceRequestStatus status) {
<span class="nc" id="L308">    this.sr.setStatus(status);</span>
<span class="nc" id="L309">  }</span>

  private void setHoverStyling(HBox c) {
<span class="nc" id="L312">    c.setOnMouseEntered(e -&gt; c.setBackground(hoverBG));</span>

<span class="nc" id="L314">    c.setOnMouseExited(e -&gt; c.setBackground(nonHoverBG));</span>
<span class="nc" id="L315">  }</span>

  public ServiceRequest getServiceRequest() {
<span class="nc" id="L318">    return this.sr;</span>
  }

  private void createSpacer(HBox c) {
<span class="nc" id="L322">    final Region spacer = new Region();</span>
    // Make it always grow or shrink according to the available space
<span class="nc" id="L324">    HBox.setHgrow(spacer, Priority.ALWAYS);</span>
<span class="nc" id="L325">    c.getChildren().add(spacer);</span>
<span class="nc" id="L326">  }</span>

  private void createBookend(HBox c, double w) {
<span class="nc" id="L329">    final Region spacer = new Region();</span>
    // Make it always grow or shrink according to the available space
<span class="nc" id="L331">    spacer.setPrefWidth(w);</span>
<span class="nc" id="L332">    spacer.setMaxWidth(w);</span>
<span class="nc" id="L333">    spacer.setMinWidth(w);</span>
<span class="nc" id="L334">    HBox.setHgrow(spacer, Priority.SOMETIMES);</span>
<span class="nc" id="L335">    c.getChildren().add(spacer);</span>
<span class="nc" id="L336">  }</span>

  private Color getServiceRequestColor() {
<span class="nc" id="L339">    return this.sr.getDBType().getColor();</span>
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.4.201905082037</span></div></body></html>